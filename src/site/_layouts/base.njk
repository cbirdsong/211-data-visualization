<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{ title }}</title>
    {# <link rel="stylesheet" href="https://thecurrentla.com/wp-content/themes/paperback-child/editor.css"> #}
    {% set css %}
    {% include "css/reset.css" %}
    {% include "css/main.css" %}
    {% endset %}
    <style>
      {{css | safe}}
    </style>
  </head>
  <body>
    <div class="lifeline lifeline-wrapper" data-active-category="intro">
      <header class="lifeline-header">
        <div class="lifeline-header-text">
          <h1>{{ title }}</h1>
        </div>
        <nav class="lifeline-header-nav" aria-label="Main Menu">
          <button class="button category-intro active" data-category="intro">
            About
          </button>
          {% for category in categories %}
            <button class="button category-{{ category.slug }} visually-hidden" data-category="{{ category.slug }}">
              {{ category.name }}
            </button>
          {% endfor %}
        </nav>
      </header>
      <div class="layout-wrapper">
        <main class="container content-container">
          <div class="scrollable-wrapper-outer">
            <div class="scrollable-wrapper-inner">
              <div class="content">
                <section class="category category-intro active" data-category="intro">
                  <article class="card card--intro category-intro">
                    {% for summary in summaries %}
                      {% if summary.category == "Intro" %}
                        <div class="card--intro__content">
                          <p>{{ summary.text }}</p>
                        </div>
                      {% endif %}
                    {% endfor %}
                    <nav class="intro-nav" aria-label="Categories">
                      {% for category in categories %}
                        <button class="button category-{{ category.slug }}" data-category="{{ category.slug }}">
                          {{ category.name }}
                        </button>
                      {% endfor %}
                    </nav>
                  </article>
                </section>
                {%- for category in categories -%}
                  <section class="category category-{{ category.slug }}" data-category="{{ category.slug }}">
                    <h2 class="visually-hidden">{{ category.name }}</h2>
                    <div class="card-group">
                      {%- for item in entries -%}
                        {%- if item.category == category.name or item.category == "All" -%}
                          <article class="card card--{{ item.type }}  category-{{ category.slug }} date-{{ item.date_num }}" data-date="{{ item.date_num }}">
                            {% if item.type == 'intro' %}
                              {% if item.title %}
                                <div class="card--{{ item.type }}__title">
                                  <strong>{{ item.title }}</strong>
                                </div>
                              {% endif %}
                              <div class="card--{{ item.type }}__content">
                                <p>
                                  {{ item.text }}
                                </p>
                              </div>
                            {% endif %}
                            {% if item.type == 'call' %}
                              <div class="card--{{ item.type }}__meta card--{{ item.type }}__header">
                                <span class="date">{{ item.date_medium }}</span>
                                {% if item.time %}
                                  <span class="time">{{ item.time }}</span>
                                {% endif %}
                                {% if item.parish %}
                                  <span class="parish">
                                    {{ item.parish }}
                                    Parish
                                  </span>
                                {% endif %}
                              </div>
                              <div class="card--{{ item.type }}__content">
                                <p>{{ item.text }}</p>
                              </div>
                              <div class="card--{{ item.type }}__meta card--{{ item.type }}__footer">
                                <span>
                                  <small>Duration:</small>
                                  {{ item.length | int }}
                                  min.</span>
                              </div>
                            {% endif %}
                            {% if item.type == 'news' or item.type == 'note' %}
                              <div class="card--{{ item.type }}__title">
                                <div class="dateline">
                                  {{ item.date_medium }}
                                </div>
                                <strong>{{ item.headline }}</strong>
                              </div>
                              {% if item.text %}
                                <div class="card--{{ item.type }}__content">
                                  <p>
                                    {{ item.text }}
                                  </p>
                                </div>
                              {% endif %}
                              {% if item.sourceurl and item.sourcename %}
                                <div class="card--{{ item.type }}__link">
                                  <a href="{{item.sourceurl}}">{{ item.sourcename }}</a>
                                </div>
                              {% endif %}
                            {% endif %}
                          </article>
                        {%- endif -%}
                      {%- endfor -%}
                    </div>
                  </section>
                {%- endfor -%}
              </div>
            </div>
          </div>
        </main>
        <div class="container scrolless-container graph-container">
          <div class="graph" style="--count-total: {{ stat_totals.largest }}">
            {%- for item in stats -%}
              <div class="line" data-date="{{ item.date_num }}">
                <div class="line__date line__text">
                  <span class="date">{{ item.date_short }}</span>
                  <strong class="day">{{ item.day | truncate(1, true, "") }}</strong>
                </div>
                {% for category in categories %}
                  {% if category.slug == "health" %}
                    {% set amount = item.health %}
                  {% endif %}
                  {% if category.slug == "food" %}
                    {% set amount = item.food %}
                  {% endif %}
                  {% if category.slug == "housing" %}
                    {% set amount = item.housing %}
                  {% endif %}
                  {% if category.slug == "financial" %}
                    {% set amount = item.financial %}
                  {% endif %}
                  <div class="line__display category-{{ category.slug }}" style="--count: {{ amount }};" data-count="{{ amount }}">
                    <span class="visually-hidden">
                      {{ category.name }}:
                      {{ amount }}
                      Calls
                    </span>
                  </div>
                {%- endfor -%}
              </div>
            {%- endfor -%}
          </div>
        </div>
      </div>

      <footer class="lifeline-footer">
        <div class="footer-content text-small">
          <p>Quam illa ardentis amores excitaret sui! Cur tandem? Hoc est non dividere, sed frangere. Ergo adhuc, quantum equidem intellego, causa non videtur fuisse mutandi nominis. Est enim effectrix multarum et magnarum voluptatum.</p>
        </div>
        <nav class="lifeline-footer-nav" aria-label="Categories">
          {% for category in categories %}
            <button class="button category-{{ category.slug }}" data-category="{{ category.slug }}">
              {{ category.name }}
            </button>
          {% endfor %}
        </nav>
      </footer>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/ScrollTrigger.min.js"></script>

    <script>
      document
        .querySelectorAll('button[data-category]')
        .forEach(function (button) {
          button.addEventListener('click', function (event) {
            var category = event.target.dataset.category;

            document
              .querySelectorAll('[data-category].active')
              .forEach(function (item) {
                item
                  .classList
                  .remove("active");

              });
            document
              .querySelectorAll('[data-category="' + category + '"]')
              .forEach(function (item) {
                item
                  .classList
                  .add("active");
              });
            document
              .querySelectorAll('.lifeline')
              .forEach(function (item) {
                item.dataset.activeCategory = category;
              });

          });
        });
    </script>
  </body>
</html>